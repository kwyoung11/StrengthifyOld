webshims.register("forms-picker",function(t,e,n,a,i,s){"use strict";var o=e.picker,r=o._actions,c=s,l=function(t){var e=[t.getFullYear(),c.addZero(t.getMonth()+1),c.addZero(t.getDate())];return e.month=e[0]+"-"+e[1],e.date=e[0]+"-"+e[1]+"-"+e[2],e},d=l(new Date((new Date).getTime()-60*(new Date).getTimezoneOffset()*1e3)),u=function(e){e=t(e||this.activeButton),this.activeButton.attr({tabindex:"-1","aria-selected":"false"}),this.activeButton=e.attr({tabindex:"0","aria-selected":"true"}),this.index=this.buttons.index(this.activeButton[0]),clearTimeout(this.timer),o._genericSetFocus.apply(this,arguments)},h=function(){var e;this.popover.navedInitFocus&&(e=this.popover.navedInitFocus.sel||this.popover.navedInitFocus,this.activeButton&&this.activeButton[0]||!this.buttons[e]?e&&(this.activeButton=t(e,this.element)):this.activeButton=this.buttons[e](),!this.activeButton[0]&&this.popover.navedInitFocus.alt&&(this.activeButton=this.buttons[this.popover.navedInitFocus.alt]())),this.activeButton&&this.activeButton[0]||(this.activeButton=this.buttons.filter(".checked-value")),this.activeButton[0]||(this.activeButton=this.buttons.filter(".this-value")),this.activeButton[0]||(this.activeButton=this.buttons.eq(0)),this.setFocus(this.activeButton,this.opts.noFocus)},p=e.formcfg,v=p[t.webshims.activeLang()]||p[""];t.webshims.activeLang({register:"form-core",callback:function(){t.each(arguments,function(t,e){return p[e]?(v=p[e],!1):void 0})}}),e.ListBox=function(e,n,a){this.element=t("ul",e),this.popover=n,this.opts=a||{},this.buttons=t("button:not(:disabled)",this.element),this.ons(this),this._initialFocus()},e.ListBox.prototype={setFocus:u,_initialFocus:h,prev:function(){var t=this.index-1;0>t?this.opts.prev&&(this.popover.navedInitFocus="last",this.popover.actionFn(this.opts.prev),this.popover.navedInitFocus=!1):this.setFocus(this.buttons.eq(t))},next:function(){var t=this.index+1;t>=this.buttons.length?this.opts.next&&(this.popover.navedInitFocus="first",this.popover.actionFn(this.opts.next),this.popover.navedInitFocus=!1):this.setFocus(this.buttons.eq(t))},ons:function(t){this.element.on({keydown:function(e){var n,a=e.keyCode;return e.ctrlKey?void 0:(36==a||33==a?(t.setFocus(t.buttons.eq(0)),n=!0):34==a||35==a?(t.setFocus(t.buttons.eq(t.buttons.length-1)),n=!0):38==a||37==a?(t.prev(),n=!0):(40==a||39==a)&&(t.next(),n=!0),n?!1:void 0)}})}},e.Grid=function(e,n,a){this.element=t("tbody",e),this.popover=n,this.opts=a||{},this.buttons=t("button:not(:disabled,.othermonth)",this.element),this.ons(this),this._initialFocus(),this.popover.openedByFocus&&(this.popover.activeElement=this.activeButton)},e.Grid.prototype={setFocus:u,_initialFocus:h,first:function(){this.setFocus(this.buttons.eq(0))},last:function(){this.setFocus(this.buttons.eq(this.buttons.length-1))},upPage:function(){t(".ws-picker-header > button:not(:disabled)",this.popover.element).trigger("click")},downPage:function(){this.activeButton.filter(':not([data-action="changeInput"])').trigger("click")},ons:function(t){this.element.on({keydown:function(e){var n,a=e.keyCode;return e.shiftKey?void 0:(e.ctrlKey&&40==a?n="downPage":e.ctrlKey&&38==a?n="upPage":33==a||e.ctrlKey&&37==a?n="prevPage":34==a||e.ctrlKey&&39==a?n="nextPage":36==e.keyCode||33==e.keyCode?n="first":35==e.keyCode?n="last":38==e.keyCode?n="up":37==e.keyCode?n="prev":40==e.keyCode?n="down":39==e.keyCode&&(n="next"),n?(t[n](),!1):void 0)}})}},t.each({prevPage:{get:"last",action:"prev"},nextPage:{get:"first",action:"next"}},function(t,n){e.Grid.prototype[t]=function(){this.opts[n.action]&&(this.popover.navedInitFocus={sel:'button[data-id="'+this.activeButton.attr("data-id")+'"]:not(:disabled,.othermonth)',alt:n.get},this.popover.actionFn(this.opts[n.action]),this.popover.navedInitFocus=!1)}}),t.each({up:{traverse:"prevAll",get:"last",action:"prev",reverse:!0},down:{traverse:"nextAll",get:"first",action:"next"}},function(n,a){e.Grid.prototype[n]=function(){var e=this.activeButton.closest("td").prop("cellIndex"),n="td:nth-child("+(e+1)+") button:not(:disabled,.othermonth)",i=this.activeButton.closest("tr")[a.traverse]();a.reverse&&(i=t(i.get().reverse())),i=i.find(n)[a.get](),i[0]?this.setFocus(i.eq(0)):this.opts[a.action]&&(this.popover.navedInitFocus=n+":"+a.get,this.popover.actionFn(this.opts[a.action]),this.popover.navedInitFocus=!1)}}),t.each({prev:{traverse:"prevAll",get:"last",reverse:!0},next:{traverse:"nextAll",get:"first"}},function(n,a){e.Grid.prototype[n]=function(){var e="button:not(:disabled,.othermonth)",i=this.activeButton.closest("td")[a.traverse]("td");a.reverse&&(i=t(i.get().reverse())),i=i.find(e)[a.get](),i[0]||(i=this.activeButton.closest("tr")[a.traverse]("tr"),a.reverse&&(i=t(i.get().reverse())),i=i.find(e)[a.get]()),i[0]?this.setFocus(i.eq(0)):this.opts[n]&&(this.popover.navedInitFocus=a.get,this.popover.actionFn(this.opts[n]),this.popover.navedInitFocus=!1)}}),o.getWeek=function(t){var e,n=new Date(t.getTime());return n.setDate(n.getDate()+4-(n.getDay()||7)),e=n.getTime(),n.setMonth(0),n.setDate(1),Math.floor(Math.round((e-n)/864e5)/7)+1},o.getYearList=function(t,e){var n,a,i,s,r,c,l,u,h,p,v=e.options.size,b=e.options.max.split("-"),m=e.options.min.split("-"),g=e.options.value.split("-"),f=0,y=0,w="",x=0;for("max"==e.options.useDecadeBase&&b[0]?f=11-b[0]%12:"min"==e.options.useDecadeBase&&m[0]&&(f=11-m[0]%12),t=1*t[0],p=t-(t+f)%(12*v),n=0;v>n;n++){for(n?p+=12:c=o.isInRange([p-1],b,m)?{"data-action":"setYearList",value:p-1}:!1,w+='<div class="year-list picker-list ws-index-'+n+'"><div class="ws-picker-header"><button disabled="disabled">'+p+" \u2013 "+(p+11)+"</button></div>",r=[],a=0;12>a;a++)i=p+a,h=[],o.isInRange([i],b,m)?(s="",y++):s=' disabled=""',i==d[0]&&h.push("this-value"),g[0]==i&&h.push("checked-value"),u=h.length?' class="'+h.join(" ")+'"':"",!a||a%3||(x++,r.push('</tr><tr class="ws-row-'+x+'">')),r.push('<td class="ws-item-'+a+'" role="presentation"><button  data-id="year-'+a+'" type="button"'+s+u+' data-action="setMonthList" value="'+i+'" tabindex="-1" role="gridcell">'+i+"</button></td>");n==v-1&&(l=o.isInRange([i+1],b,m)?{"data-action":"setYearList",value:i+1}:!1),w+='<div class="picker-grid"><table role="grid" aria-label="'+p+" \u2013 "+(p+11)+'"><tbody><tr class="ws-row-0">'+r.join("")+"</tr></tbody></table></div></div>"}return{enabled:y,main:w,next:l,prev:c,type:"Grid"}},o.getMonthList=function(t,e){var n,a,i,s,r,c,l,u,h,p,b,m=e.options,g=m.size,f=m.max.split("-"),y=m.min.split("-"),w=m.value.split("-"),x=0,k=0,D="";for(t=t[0]-Math.floor((g-1)/2),n=0;g>n;n++){for(n?t++:u=o.isInRange([t-1],f,y)?{"data-action":"setMonthList",value:t-1}:!1,n==g-1&&(h=o.isInRange([t+1],f,y)?{"data-action":"setMonthList",value:t+1}:!1),c=[],o.isInRange([t,"01"],f,y)||o.isInRange([t,"12"],f,y)?(l=!1,r=""):(r=' disabled=""',l=!0),m.minView>=1&&(r=' disabled=""'),D+='<div class="month-list picker-list ws-index-'+n+'"><div class="ws-picker-header">',D+=m.selectNav?'<select data-action="setMonthList" class="year-select">'+o.createYearSelect(t,f,y).join("")+"</select>":'<button data-action="setYearList"'+r+' value="'+t+'" tabindex="-1">'+t+"</button>",D+="</div>",a=0;12>a;a++)s=v.date.monthkeys[a+1],i=(v.date[m.monthNames]||v.date.monthNames)[a],b=[],l||!o.isInRange([t,s],f,y)?r=' disabled=""':(r="",x++),t==d[0]&&d[1]==s&&b.push("this-value"),w[0]==t&&w[1]==s&&b.push("checked-value"),p=b.length?' class="'+b.join(" ")+'"':"",!a||a%3||(k++,c.push('</tr><tr class="ws-row-'+k+'">')),c.push('<td class="ws-item-'+a+'" role="presentation"><button data-id="month-'+a+'" type="button"'+r+p+' data-action="'+("month"==e.type?"changeInput":"setDayList")+'" value="'+t+"-"+s+'" tabindex="-1" role="gridcell" aria-label="'+v.date.monthNames[a]+'">'+i+"</button></td>");D+='<div class="picker-grid"><table role="grid" aria-label="'+t+'"><tbody><tr class="ws-row-0">'+c.join("")+"</tr></tbody></table></div></div>"}return{enabled:x,main:D,prev:u,next:h,type:"Grid"}},o.getDayList=function(e,n){var a,i,s,r,c,u,h,p,b,m,g,f,y,w,x,k,D,I,F,B=n.options,L=B.size,M=B.max.split("-"),E=B.min.split("-"),R=B.value.split("-"),S=v.date[B.monthNamesHead]||v.date[B.monthNames]||v.date.monthNames,N=[],T=new Date(e[0],e[1]-1,1);for(T.setMonth(T.getMonth()-Math.floor((L-1)/2)),a=0;L>a;a++){for(T.setDate(1),g=T.getMonth(),m=0,a||(I=new Date(T.getTime()),I.setDate(-1),w=l(I),u=o.isInRange(w,M,E)?{"data-action":"setDayList",value:w[0]+"-"+w[1]}:!1),w=l(T),N.push('<div class="day-list picker-list ws-index-'+a+'"><div class="ws-picker-header">'),B.selectNav&&(x=['<select data-action="setDayList" class="month-select" tabindex="0">'+o.createMonthSelect(w,M,E,S).join("")+"</select>",'<select data-action="setDayList" class="year-select" tabindex="0">'+o.createYearSelect(w[0],M,E,"-"+w[1]).join("")+"</select>"],v.date.showMonthAfterYear&&x.reverse(),N.push(x.join(" "))),k=[v.date.monthNames[1*w[1]-1],w[0]],x=[S[1*w[1]-1],w[0]],v.date.showMonthAfterYear&&(x.reverse(),k.reverse()),n.options.selectNav||N.push('<button data-action="setMonthList"'+(B.minView>=2?' disabled="" ':"")+' value="'+w.date+'" tabindex="-1">'+x.join(" ")+"</button>"),N.push('</div><div class="picker-grid"><table role="grid" aria-label="'+k.join(" ")+'"><thead><tr>'),n.options.showWeek&&N.push('<th class="week-header">'+v.date.weekHeader+"</th>"),s=v.date.firstDay;s<v.date.dayNamesShort.length;s++)N.push('<th class="day-'+s+'"><abbr title="'+v.date.dayNames[s]+'">'+v.date.dayNamesShort[s]+"</abbr></th>");for(s=v.date.firstDay;s--;)N.push('<th class="day-'+s+'"><abbr title="'+v.date.dayNames[s]+'">'+v.date.dayNamesShort[s]+"</abbr></th>");for(N.push('</tr></thead><tbody><tr class="ws-row-0">'),n.options.showWeek&&(b=o.getWeek(T),N.push('<td class="week-cell">'+b+"</td>")),i=0;99>i;i++){if(p=i&&!(i%7),f=T.getMonth(),y=g!=f,r=T.getDay(),F=[],p&&y){N.push("</tr>");break}p&&(m++,N.push('</tr><tr class="ws-row-'+m+'">'),n.options.showWeek&&(b++,b>52&&(b=o.getWeek(T)),N.push('<td class="week-cell">'+b+"</td>"))),i||r!=v.date.firstDay&&(c=r-v.date.firstDay,0>c&&(c+=7),T.setDate(T.getDate()-c),r=T.getDay(),f=T.getMonth(),y=g!=f),w=l(T),D='<td role="presentation" class="day-'+r+'"><button data-id="day-'+T.getDate()+'" role="gridcell" data-action="changeInput" value="'+w.join("-")+'"',F.push(y?"othermonth":"day-"+T.getDate()),w[0]==d[0]&&d[1]==w[1]&&d[2]==w[2]&&F.push("this-value"),R[0]==w[0]&&w[1]==R[1]&&w[2]==R[2]&&F.push("checked-value"),F.length&&(D+=' class="'+F.join(" ")+'"'),(!o.isInRange(w,M,E)||n.options.disableDays&&-1!=t.inArray(r,n.options.disableDays))&&(D+=' disabled=""'),N.push(D+' tabindex="-1">'+T.getDate()+"</button></td>"),T.setDate(T.getDate()+1)}N.push("</tbody></table></div></div>"),a==L-1&&(w=l(T),w[2]=1,h=o.isInRange(w,M,E)?{"data-action":"setDayList",value:w.date}:!1)}return{enabled:9,main:N.join(""),prev:u,next:h,type:"Grid"}},o.isInRange=function(t,e,n){var a,i=!0;for(a=0;a<t.length;a++){if(n[a]&&n[a]>t[a]){i=!1;break}if(!n[a]||n[a]!=t[a])break}if(i)for(a=0;a<t.length;a++){if(e[a]&&e[a]<t[a]){i=!1;break}if(!e[a]||e[a]!=t[a])break}return i},o.createMonthSelect=function(t,e,n,a){a||(a=v.date.monthNames);for(var i,s=0,r=[],l=t[1]-1;s<a.length;s++)i=l==s?' selected=""':"",(i||o.isInRange([t[0],s+1],e,n))&&r.push('<option value="'+t[0]+"-"+c.addZero(s+1)+'"'+i+">"+a[s]+"</option>");return r},o.createYearSelect=function(t,e,n,a){var i,s=!0,r=!0,c=['<option selected="">'+t+"</option>"],l=0;for(a||(a="");8>l&&(s||r);)l++,i=t-l,s&&o.isInRange([i],e,n)?c.unshift('<option value="'+(i+a)+'">'+i+"</option>"):s=!1,i=t+l,r&&o.isInRange([i],e,n)?c.push('<option value="'+(i+a)+'">'+i+"</option>"):r=!1;return c},function(){var n=function(t){return"get"+t+"List"},a=function(t){return"set"+t+"List"},i={date:"Day",week:"Day",month:"Month"};t.each({setYearList:["Year","Month","Day"],setMonthList:["Month","Day"],setDayList:["Day"]},function(s,c){var l=c.map(n),d=c.map(a);r[s]=function(n,a,s,r){n=""+n;var u=s.options,h=n.split("-");r||(r=0),t.each(l,function(t,n){if(t>=r){var l=o[n](h,s);if(h.length<2||l.enabled>1||i[s.type]===c[t])return a.element.attr({"data-currentview":d[t]}).addClass("ws-size-"+u.size).data("pickercontent",{data:s,content:l,values:h}),a.bodyElement.html(l.main),l.prev?a.prevElement.attr(l.prev).prop({disabled:!1}):a.prevElement.removeAttr("data-action").prop({disabled:!0}),l.next?a.nextElement.attr(l.next).prop({disabled:!1}):a.nextElement.removeAttr("data-action").prop({disabled:!0}),e[l.type]&&new e[l.type](a.bodyElement.children(),a,l),a.element.trigger("pickerchange"),!1}})}})}(),o.showPickerContent=function(t,e){var n=t.options;t._popoverinit||(o.commonInit(t,e),o.commonDateInit(t,e)),!t._popoverinit||n.restartView?r.setYearList(n.defValue||n.value,e,t,n.startView):r[e.element.attr("data-currentview")||"setYearList"](n.defValue||n.value,e,t,0),t._popoverinit=!0},o.commonDateInit=function(n,i){var s=function(){return t(this).is(".othermonth")&&"pointer"!=t(this).css("cursor")||i.actionFn({"data-action":t.attr(this,"data-action"),value:t(this).val()||t.attr(this,"value")}),!1},c=(new Date).getTime(),l=function(a){var s=[],r="",l="";a.options=n.getOptions()||{},t("div.ws-options",i.contentElement).remove(),t.each(a.options[0],function(t,e){var i=o.isInRange(t.split("-"),a.maxS,a.minS)?"":' disabled="" ';s.push('<li role="presentation"><button value="'+t+'" '+i+' data-action="changeInput" tabindex="-1"  role="option">'+(e||n.formatValue(t,!1))+"</button></li>")}),s.length&&(c++,a.options[1]&&(l="datalist-"+c,r='<h5 id="'+l+'">'+a.options[1]+"</h5>",l=' aria-labelledbyid="'+l+'" '),new e.ListBox(t('<div class="ws-options">'+r+'<ul role="listbox" '+l+">"+s.join("")+"</div>").insertAfter(i.bodyElement)[0],i,{noFocus:!0}))},u=function(){if(i.isDirty){var a=n.options;a.maxS=a.max.split("-"),a.minS=a.min.split("-"),t("button",i.buttonRow).each(function(){var i;t(this).is(".ws-empty")?(i=v.date.clear,i||(i=p[""].date.clear||"clear",e.warn("could not get clear text from form cfg"))):t(this).is(".ws-current")&&(i=(v[n.type]||{}).currentText,i||(i=(p[""][[n.type]]||{}).currentText||"current",e.warn("could not get currentText from form cfg")),t.prop(this,"disabled",!o.isInRange(d[n.type].split("-"),a.maxS,a.minS))),i&&(t(this).text(i).attr({"aria-label":i}),e.assumeARIA&&t.attr(this,"aria-label",i))}),i.nextElement.attr({"aria-label":v.date.nextText}),t("> span",i.nextElement).html(v.date.nextText),i.prevElement.attr({"aria-label":v.date.prevText}),t("> span",i.prevElement).html(v.date.prevText),l(a,a.maxS,a.minS)}t("button.ws-empty",i.buttonRow).prop("disabled",t.prop(n.orig,"required")),i.isDirty=!1};i.actionFn=function(t){r[t["data-action"]]?r[t["data-action"]](t.value,i,n,0):e.warn("no action for "+t["data-action"])},i.contentElement.html('<button class="ws-prev" tabindex="0"><span></span></button> <button class="ws-next" tabindex="0"><span></span></button><div class="ws-picker-body"></div><div class="ws-button-row"><button type="button" class="ws-current" data-action="changeInput" value="'+d[n.type]+'" tabindex="0"></button> <button type="button" data-action="changeInput" value="" class="ws-empty" tabindex="0"></button></div>'),i.nextElement=t("button.ws-next",i.contentElement),i.prevElement=t("button.ws-prev",i.contentElement),i.bodyElement=t("div.ws-picker-body",i.contentElement),i.buttonRow=t("div.ws-button-row",i.contentElement),i.element.on("updatepickercontent",u),i.contentElement.on("click","button[data-action]",s).on("change","select[data-action]",s),t(n.options.orig).on("input",function(){var t;n.options.updateOnInput&&i.isVisible&&n.options.value&&(t=i.element.attr("data-currentview"))&&r[t](n.options.value,i,n,0)}),t(a).onTrigger("wslocalechange",n._propertyChange)}});