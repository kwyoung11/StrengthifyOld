webshims.register("form-datalist-lazy",function(t,i,e,s,a,o){var n=0,l=t.webshims.cfg.forms,r={},d=function(t){if(!t)return[];if(r[t])return r[t];var i;try{i=JSON.parse(localStorage.getItem("storedDatalistOptions"+t))}catch(e){}return r[t]=i||[],i||[]},h=function(t,i){if(t){i=i||[];try{localStorage.setItem("storedDatalistOptions"+t,JSON.stringify(i))}catch(e){}}},p=/</g,u=/>/g;t.extend(o.shadowListProto,{_lazyCreate:function(s){var a=this;this.hideList=t.proxy(a,"hideList"),this.popover=i.objectCreate(i.wsPopover,{},o.datalistPopover),this.shadowList=this.popover.element.addClass("datalist-polyfill"),this.index=-1,this.input=s.input,this.arrayOptions=[],this.shadowList.delegate("li","mouseenter.datalistWidget mousedown.datalistWidget click.datalistWidget",function(i){var e=t("li:not(.hidden-item)",a.shadowList),o="mousedown"==i.type||"click"==i.type;return a.markItem(e.index(i.currentTarget),o,e),"click"==i.type&&(a.hideList(),l.customDatalist&&t(s.input).getNativeElement().trigger("datalistselect")),"mousedown"!=i.type}),s.input.setAttribute("autocomplete","off"),t(s.input).attr({"aria-haspopup":"true"}).on({"input.datalistWidget":function(){a.triggeredByDatalist||(a.changedValue=!1,a.showHideOptions())},"keydown.datalistWidget":function(i){var e,o,n=i.keyCode;return 40!=n||a.showList()?a.popover.isVisible?38==n?(a.markItem(a.index-1,!0),!1):i.shiftKey||33!=n&&36!=n?i.shiftKey||34!=n&&35!=n?(13==n||27==n)&&(13==n&&(e=t("li.active-item:not(.hidden-item)",a.shadowList),a.changeValue(t("li.active-item:not(.hidden-item)",a.shadowList))),a.hideList(),l.customDatalist&&e&&e[0]&&t(s.input).getNativeElement().trigger("datalistselect"),13!=i.keyCode||e&&e[0])?!1:void 0:(o=t("li:not(.hidden-item)",a.shadowList),a.markItem(o.length-1,!0,o),!1):(a.markItem(0,!0),!1):void 0:(a.markItem(a.index+1,!0),!1)},"focus.datalistWidget":function(){t(this).hasClass("list-focus")&&a.showList()},"mousedown.datalistWidget":function(){t(this).is(":focus")&&a.showList()}}),t(this.datalist).off("updateDatalist.datalistWidget").on("updateDatalist.datalistWidget",t.proxy(this,"_resetListCached")).on("remove",function(t){t.originalEvent||a.detroy()}),this._resetListCached(),s.input.form&&(s.input.name||s.input.id)&&t(s.input.form).on("submit.datalistWidget"+s.input.id,function(){if(!t(s.input).hasClass("no-datalist-cache")&&"off"!=a._autocomplete){var i=t.prop(s.input,"value"),e=(s.input.name||s.input.id)+t.prop(s.input,"type");a.storedOptions||(a.storedOptions=d(e)),i&&-1==a.storedOptions.indexOf(i)&&(a.storedOptions.push(i),h(e,a.storedOptions))}}),t(e).on("unload.datalist"+this.id+" beforeunload.datalist"+this.id,function(t){a.destroy(t)})},_resetListCached:function(){var s,a=this;this.needsUpdate=!0,this.lastUpdatedValue=!1,this.lastUnfoundValue="",this.updateTimer||(e.QUnit||(s=t(a.input).is(":focus")&&(t(a.input).hasClass("list-focus")||t.prop(a.input,"value")))?a.updateListOptions(s):i.ready("WINDOWLOAD",function(){a.updateTimer=setTimeout(function(){a.updateListOptions(),a=null,n=1},200+100*n)}))},updateListOptions:function(i){this.needsUpdate=!1,clearTimeout(this.updateTimer),this.updateTimer=!1,this.searchStart=l.customDatalist&&t(this.input).hasClass("search-start"),this.addMarkElement=o.addMark||t(this.input).hasClass("mark-option-text");var e,s,a,n,r,h,c,m=[],f=[],v=[];for(a=t.prop(this.datalist,"options"),n=0,r=a.length;r>n;n++)e=a[n],!e.disabled&&(c=t(e).val())&&(s={value:c.replace(p,"&lt;").replace(u,"&gt;"),label:t.trim(t.attr(e,"label"))||"",className:e.className||""},s.label&&(s.className+=" has-option-label"),f.push(s.value),v.push(s));for(this.storedOptions||(this.storedOptions=t(this.input).hasClass("no-datalist-cache")||"off"==this._autocomplete?[]:d((this.input.name||this.input.id)+t.prop(this.input,"type"))),this.storedOptions.forEach(function(t){-1==f.indexOf(t)&&v.push({value:t,label:"",className:"stored-suggest",style:""})}),n=0,r=v.length;r>n;n++)h=v[n],m[n]='<li class="'+h.className+'" tabindex="-1" role="listitem">'+this.getOptionContent(h)+"</li>";this.arrayOptions=v,this.popover.contentElement.html('<div class="datalist-box"><ul role="list">'+m.join("\n")+"</ul></div>"),(i||this.popover.isVisible)&&this.showHideOptions()},getOptionContent:function(t){var i="";return o.getOptionContent?i=o.apply(this,arguments)||"":(i='<span class="option-value">'+t.value+"</span>",t.label&&(i+=' <span class="option-label">'+t.label+"</span>")),i},showHideOptions:function(i){var e=t.prop(this.input,"value").toLowerCase();if(e!==this.lastUpdatedValue){if(this.lastUnfoundValue&&0===e.indexOf(this.lastUnfoundValue))return void this.hideList();this.lastUpdatedValue=e;var s=!1,a=this.searchStart,o=t("li",this.shadowList),n=this;e?this.arrayOptions.forEach(function(i,l){var r,d,h;"lowerValue"in i||(i.lowerValue=i.value.toLowerCase(),i.label&&i.label!=i.value&&(i.lowerLabel=i.label.toLowerCase())),e!=i.lowerValue&&i.lowerLabel!=e&&(d=i.lowerValue.indexOf(e),r=a?!d:-1!==d,r?h="value":i.lowerLabel&&(d=i.lowerLabel.indexOf(e),r=a?!d:-1!==d,h="label")),r?(n.addMark(t(o[l]).removeClass("hidden-item"),i,h,d,e.length),s=!0):t(o[l]).addClass("hidden-item")}):o.length&&(this.removeMark(o.removeClass("hidden-item")),s=!0),this.hasViewableData=s,!i&&s&&this.showList(),s?this.lastUnfoundValue=!1:(this.lastUnfoundValue=e,this.hideList())}},otherType:{value:"label",label:"value"},addMark:function(i,e,s,a,o){if(this.addMarkElement){var n=e[s].substr(a,o);n=e[s].replace(n,"<mark>"+n+"</mark>"),t(".option-"+this.otherType[s]+" > mark",i).each(this._replaceMark),t(".option-"+s,i).html(n)}},_replaceMark:function(){var i=t(this).html();t(this).replaceWith(i)},removeMark:function(i){this.addMarkElement&&t("mark",i).each(this._replaceMark)},showList:function(){if(this.popover.isVisible)return!1;if(this.needsUpdate&&this.updateListOptions(),this.showHideOptions(!0),!this.hasViewableData)return!1;var t=this;return t.shadowList.find("li.active-item").removeClass("active-item"),t.popover.show(this.input),!0},hideList:function(){if(!this.popover.isVisible)return!1;var i=this;return this.popover.hide(),i.shadowList.removeClass("datalist-visible list-item-active"),i.index=-1,i.changedValue&&(i.triggeredByDatalist=!0,t(i.input).trigger("input").trigger("change"),i.changedValue=!1,i.triggeredByDatalist=!1),!0},scrollIntoView:function(i){var e,s=t("ul",this.shadowList),a=t("div.datalist-box",this.shadowList),o=i.position();return o.top-=(parseInt(s.css("paddingTop"),10)||0)+(parseInt(s.css("marginTop"),10)||0)+(parseInt(s.css("borderTopWidth"),10)||0),o.top<0?void a.scrollTop(a.scrollTop()+o.top-2):(o.top+=i.outerHeight(),e=a.height(),void(o.top>e&&a.scrollTop(a.scrollTop()+(o.top-e)+2)))},changeValue:function(i){if(i[0]){var e,s=t("span.option-value",i).text(),a=t.prop(this.input,"value");s!=a&&(t(this.input).prop("value",s).triggerHandler("updateInput"),this.changedValue=!0,(e=t.data(this.input,"wsspinner"))&&e.setInput&&e.setInput(s))}},markItem:function(i,e,s){var a;s=s||t("li:not(.hidden-item)",this.shadowList),s.length&&(0>i?i=s.length-1:i>=s.length&&(i=0),s.removeClass("active-item"),this.shadowList.addClass("list-item-active"),a=s.filter(":eq("+i+")").addClass("active-item"),e&&(this.changeValue(a),this.scrollIntoView(a)),this.index=i)}})});