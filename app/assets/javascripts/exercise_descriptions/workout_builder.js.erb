$(document).on('ready page:load', function () {	

if ($(".build").length > 0) {

	// Update set number
	var sets = $("input[id=workout_sets]");
		if (sets.val() == 0 && $(".exercise").length) {
			sets.val("1");
		}
	
	window.onunload = unloadPage;
	function unloadPage() {
		if ($(".build").css("display") == "block") {
			$.cookie("show_wrkt", true);
		} else {
			$.removeCookie("show_wrkt");
		}
	}

	var myCookie = $.cookie("show_wrkt");
		if (myCookie != null) {
			$(".build").show();
		}
 
 	// Add exercise_id to remove exercise link
	window.onload = loadPage;
	function loadPage() {
		var myCookie = $.cookie("show_wrkt");
		if (myCookie != null) {
			$(".build").show(10);
		}
		var i = 0;
		$(".build .exercise").each(function() {
			var id = $("input[id=workout_exercises_attributes_" + i + "_exercise_id]").val();
			var href = $(this).children(".exercise-remove").children(".remove-exercise").children("#remove-exercise").attr("href");
			href += "" + id;
			$(this).children(".exercise-remove").children(".remove-exercise").children("#remove-exercise").attr("href", href);
			$(this).attr("data-ex_id", id);
			i++;
	  });
	}

		// See sliders on reload
		$(".build .exercise .workout-rest").each(function(i) {

			if (!$(this).has(".ui-slider-handle").length) {
				$(this).children(".slider-wrapper").children(".slider").removeAttr("id").attr("id", "slider" + (i+1));
				$("#slider" + (i+1)).slider({
  	  		value: $(this).children(".exercise__rest-period").val(),
  	  		min: 0,
  	  		max: 180,
  	  		step: 5,
  	  		slide: function(event, ui) {
  	  			$("input[id=workout_exercises_attributes_" + (i) + "_rest_period_attributes_seconds]").val(ui.value);
  	  		}	
  			});
			}
		});

		// Save rest period values to session
		$(".ui-slider-handle").on('mouseup', function() {
			var rp = $(this).parents(".workout-rest").children(".exercise_rest_period").children("input[class=exercise__rest-period]").val();
			var id = $(this).parents(".exercise").attr("data-ex_id");
			$.ajax({url: "/exercise_descriptions", data: {rest_period: rp, id: id} })
		});

		$(".exercise_weight").on('focusout', function() {
			var weight = $(this).val();
			var id = $(this).parents(".exercise").attr("data-ex_id");
			$.ajax({url: "/exercise_descriptions", data: {weight: weight, id: id} })
		});

		$(".exercise_reps").on('focusout', function() {
			var reps = $(this).val();
			var id = $(this).parents(".exercise").attr("data-ex_id");
			$.ajax({url: "/exercise_descriptions", data: {reps: reps, id: id} })
		});

		// Save set number to session
		$("#workout_sets").on('focusout', function() {
			var num_sets = $("#workout_sets").val();
			$.ajax({url: "/exercise_descriptions", data: {sets: num_sets} });
		});



		// Show/hide defaults
		showHideOnClick("#default-link", ".defaults-list", 0, "", true);
		// Show/hide build workout form
		showHideOnClick("#expand-workout-bar", ".build", "fast", "rotate", false);

	} // end build if statement

});

